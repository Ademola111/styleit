"""like and unlike sessions"""
def like_post(self, post):
    desiloggedin = session.get('designer')
    loggedin = session.get('customer')
    if not self.has_liked_post(post):
        if desiloggedin:
            like = Like(like_desiid=self.like_id, like_postid=post.id)
            db.session.add(like)
        elif loggedin:
            like = Like(like_cusid=self.like_id, like_postid=post.id)
            db.session.add(like)
    
def unlike_post(self, post):
    desiloggedin = session.get('designer')
    loggedin = session.get('customer')
    if self.has_liked_post(post):
        if desiloggedin:
            Like.query.filter_by(Like.like_desiid==self.like_id, Like.like_postid==post.id).delete()
        elif loggedin:
            Like.query.filter_by(Like.like_cusid==self.like_id, Like.like_postid==post.id).delete()

def has_liked_post(self, post):
    desiloggedin = session.get('designer')
    loggedin = session.get('customer')
    if desiloggedin:
        return Like.query.filter(Like.like_desiid==self.like_id, Like.like_postid==post.id).count() > 0
    elif loggedin:
        return Like.query.filter(Like.like_cusid==self.like_id, Like.like_postid==post.id).count() > 0


request.referrer is used to redirect to same page
app.like/ route is used to redirect to same page

{% if desiloggedin not in pstn.likes|map(attribute='like_desiid')| list %}
                                    {{ pstn.likes.count() }}
                                    <i class="far fa-thumbs-up"></i>
                                    <a href="/like/{{pstn.post_id}}" style="color:rgb(0, 0, 0);"> Likes</a>
                                    {% elif loggedin not in pstn.likes|map(attribute='like_custid')| list %}
                                    {{ pstn.likes.count() }}
                                    <i class="far fa-thumbs-up"></i>
                                    <a href="/like/{{pstn.post_id}}" style="color:rgb(0, 0, 0);"> Likes</a>
                                    {% else %}


<!-- Appointment modal view -->

<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">Accept/Decline Appointment</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <h5> You have a booking apppointment. Kindly accept or decline this offer. </h5>
          <div class="row">
            <div class="col-md-6 text-start">
                <span class="m-2 p-2 btn btn-success" id="accept" value="accept">Accept</span>
            </div>
            <div class="col-md-6 text-end">
                <span class="mt-3 mb-3 btn btn-danger" id="decline" value="decline">Decline</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
"""image upload"""
@app.route('/image/', methods=['GET','POST'])
def image():
    desiloggedin = session.get('designer')
    if desiloggedin==None:
        return redirect('/')

    if request.method == 'GET':
        des=Designer.query.get(desiloggedin)
        return render_template('designer/post.html', des=des)

    if request.method == 'POST':
        imgname=request.form.get('name')
        imgs=request.files.getlist('img')
        postid=request.form.get('postid')
        if imgname=="":
            flash('fill all required fields', 'warning')
            return redirect('/posting/')
        else:
            for img in imgs:
                original_name=img.filename
                if original_name != "":
                    # spliting image path
                    extension = os.path.splitext(original_name)
                    if extension[1].lower() in ['.jpg', '.gif', '.png']:
                        fn=math.ceil(random.random()*10000000000)
                        saveas = str(fn) + extension[1]
                        img.save(f'styleitapp/static/images/postpic/{saveas}')     
                        # committing to Customer table
                        pos=Image(image_name=imgname, image_url=saveas,image_postid=postid, Image_desiid=desiloggedin)
                        db.session.add(pos)
            db.session.commit()
            flash("image uploaded successfuly", 'success')
            return redirect('/designer/profile/')

http://ademolacode.pythonanywhere.com/user/payverify


"""activation code"""
@app.route('/activate/', methods=['GET', 'POST'])
def activationcode():
    loggedin = session.get('customer')
    desiloggedin = session.get('designer')
    
    if desiloggedin==None and loggedin== None:
        return redirect('/')
    
    if request.method=='GET':
        return render_template('user/activation.html')
    
    if request.method=='POST':
        cod=request.form.get('activationcode')
        if cod != "":
            if desiloggedin:
                dd=Designer.query.filter(Designer.desi_id==desiloggedin).first()
                mcod=dd.desi_activationcode
                if cod == mcod:
                    dd.desi_status='actived'
                    db.session.commit()
                    flash('Account activated')
                    return redirect('/user/designer/login/')
                else:
                    if cod!=mcod:
                        flash('Incorect activation code')
                        return redirect('/activate/')
            elif loggedin:
                dd=Customer.query.filter(Customer.cust_id==loggedin).first()
                mcod=dd.desi_activationcode
                if cod == mcod:
                    dd.cust_status='actived'
                    db.session.commit()
                    flash('Account activated')
                    return redirect('/user/customer/login/')
                else:
                    if cod!=mcod:
                        flash('Incorect activation code')
                        return redirect('/activate/')
        else:
            flash('activation code is empty')
            return redirect('/activate/')


# sending mail
subject="Automated Email"
sender="admin@conf.com"
recipient = [eemail]
msg=Message()
msg.subject=subject
msg.sender=sender
msg.body = "Your activation code is" + fn
msg.recipients = recipient
mail.send(msg)



from sqlalchemy import func

subq_likes = db.session.query(Like.like_postid, func.count(Like.like_id)).group_by(Like.like_postid).subquery()
subq_comments = db.session.query(Comment.com_postid, func.count(Comment.com_id)).group_by(Comment.com_postid).subquery()
subq_shares = db.session.query(Share.share_postid, func.count(Share.share_id)).group_by(Share.share_postid).subquery()

pstn = db.session.query(Posting).outerjoin(subq_likes, Posting.post_id==subq_likes.c.like_postid).outerjoin(subq_comments, Posting.post_id==subq_comments.c.com_postid).outerjoin(subq_shares, Posting.post_id==subq_shares.c.share_postid).filter(Posting.post_id==Image.image_postid, Posting.post_date==today).order_by(desc(subq_likes.c.count_1), desc(subq_comments.c.count_1), desc(subq_shares.c.count_1), desc(Posting.post_date)).limit(1000).all()


tade.ogunlade@gmail.com
STYLEIT.tadeoguntade

Igbaye - town
osun state
owolabi surname
mariam - name
AS - blood group